var VueKuzzle=function(e){"use strict";function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t,n,r,i,o,s){try{var a=e[o](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(r,i)}function s(a){return function(){var e=this,s=arguments;return new Promise(function(t,n){var r=a.apply(e,s);function i(e){u(r,t,n,i,o,"next",e)}function o(e){u(r,t,n,i,o,"throw",e)}i(void 0)})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function l(i){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},t=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),t.forEach(function(e){var t,n,r;t=i,r=o[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r})}return i}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e,t,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var k=function(){function i(e,t,n){var r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];a(this,i),this.type=null,this.vm=e,this.key=t,this.initialOptions=n,this.options=Object.assign({},n),this._skip=!1,this._watchers=[],this._destroyed=!1,this._loading=!1,e.$data.$kuzzleData&&!e.$data.$kuzzleData.queries[t]&&e.$set(e.$data.$kuzzleData.queries,t,{loading:!1}),this._initOptions(),this._hasDataField=this.vm.$data.hasOwnProperty(t),this._initData(),r&&this.autostart()}var e,t;return c(i,[{key:"autostart",value:function(){"function"==typeof this.options.skip?this._skipWatcher=this.vm.$watch(this.options.skip.bind(this.vm),this.skipChanged.bind(this),{immediate:!0,deep:this.options.deep}):this.options.skip?this._skip=!0:this.start()}},{key:"skipChanged",value:function(e,t){e!==t&&(this.skip=e)}},{key:"fetchMore",value:function(){}},{key:"refresh",value:(t=s(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._skip){e.next=5;break}return e.next=3,this.stop();case 3:return e.next=5,this.start();case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"start",value:function(){var t=this;if(this.starting=!0,"function"==typeof this.initialOptions.document){var e=this.initialOptions.document.bind(this.vm);this.options.document=e(),this._watchers.push(this.vm.$watch(e,function(e){t.options.document=e,t.refresh()},{deep:this.options.deep}))}if("function"==typeof this.initialOptions.search){var n=this.initialOptions.search.bind(this.vm);this.options.search=n(),this._watchers.push(this.vm.$watch(n,function(e){t.options.search=e,t.refresh()},{deep:this.options.deep}))}return this.executeKuzzle()}},{key:"stop",value:(e=s(regeneratorRuntime.mark(function e(){var t,n,r,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=!(t=!0),r=void 0,e.prev=3,i=this._watchers[Symbol.iterator]();!(t=(o=i.next()).done);t=!0)(0,o.value)();e.next=11;break;case 7:e.prev=7,e.t0=e.catch(3),n=!0,r=e.t0;case 11:e.prev=11,e.prev=12,t||null==i.return||i.return();case 14:if(e.prev=14,n)throw r;e.next=17;break;case 17:return e.finish(14);case 18:return e.finish(11);case 19:if(this.sub)return e.next=22,this.client.realtime.unsubscribe(this.sub);e.next=23;break;case 22:this.sub=null;case 23:case"end":return e.stop()}},e,this,[[3,7,11,19],[12,,14,18]])})),function(){return e.apply(this,arguments)})},{key:"executeKuzzle",value:function(){this.starting=!1}},{key:"_initOptions",value:function(){if("function"==typeof this.initialOptions.document){var e=this.initialOptions.document.bind(this.vm);this.options.document=e()}if("function"==typeof this.initialOptions.search){var t=this.initialOptions.search.bind(this.vm);this.options.search=t()}}},{key:"_initData",value:function(){var e=this;this.options.manual||(this._hasDataField?Object.defineProperty(this.vm.$data.$kuzzleData.data,this.key,{get:function(){return e.vm.$data[e.key]},enumerable:!0,configurable:!0}):Object.defineProperty(this.vm.$data,this.key,{get:function(){return e.vm.$data.$kuzzleData.data[e.key]},enumerable:!0,configurable:!0}))}},{key:"setData",value:function(e){"object"===p(e)&&Object.freeze(e),this.vm.$set(this._hasDataField?this.vm.$data:this.vm.$data.$kuzzleData.data,this.key,e)}},{key:"getData",value:function(){return this._hasDataField?this.vm.$data[this.key]:this.vm.$data.$kuzzleData.data[this.key]}},{key:"callHandlers",value:function(e){for(var t=!1,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=!0,s=!1,a=void 0;try{for(var u,c=e[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value;if(l){t=!0;var h=l.apply(this.vm,r);if(void 0!==h&&!h)break}}}catch(e){s=!0,a=e}finally{try{o||null==c.return||c.return()}finally{if(s)throw a}}return t}},{key:"errorHandler",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.callHandlers.apply(this,[[this.options.error,this.vm.$kuzzle.error,this.vm.$kuzzle.provider.errorHandler]].concat(t))}},{key:"catchError",value:function(e){var t;this.errorHandler(e)||(console.error("[vue-kuzzle] An error has occured for ".concat(this.type," '").concat(this.key,"'")),Array.isArray(e)?(t=console).error.apply(t,o(e)):console.error(e))}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.stop(),this._skipWatcher&&this._skipWatcher())}},{key:"skip",get:function(){return this._skip},set:function(e){e?this.stop():this.start(),this._skip=e}},{key:"hasMore",get:function(){return!1}},{key:"client",get:function(){var e=this.options.client||"defaultClient";return this.vm.$kuzzle.provider.clients[e]}},{key:"clientSupportsRealtime",get:function(){return void 0===this.client.protocol.http}},{key:"index",get:function(){var e=this.options.index||this.vm.$kuzzle.index||this.vm.$kuzzle.provider.defaultIndex;if(!e)throw new Error("Index was not specified");return e}},{key:"collection",get:function(){var e=this.options.collection||this.vm.$kuzzle.collection||this.vm.$kuzzle.provider.defaultCollection;if(!e)throw new Error("Collection was not specified");return e}},{key:"loading",get:function(){return this.vm.$data.$kuzzleData&&this.vm.$data.$kuzzleData.queries[this.key]?this.vm.$data.$kuzzleData.queries[this.key].loading:this._loading},set:function(e){this._loading!==e&&(this._loading=e,this.vm.$data.$kuzzleData&&this.vm.$data.$kuzzleData.queries[this.key]&&(this.vm.$data.$kuzzleData.queries[this.key].loading=e,this.vm.$data.$kuzzleData.loading+=e?1:-1))}}]),i}();function y(e,t){var n={};for(var r in t)$(t[r],e[r],!0)||(n[r]=t[r]);return n}var m=Array.isArray,g=Object.keys,z=Object.prototype.hasOwnProperty,b=function(e){for(var t=[],n=g(e),r=0;r<n.length;r++){var i=n[r];void 0!==e[i]&&t.push(i)}return t};function $(e,t,n){if(e===t)return!0;if(e&&t&&"object"==p(e)&&"object"==p(t)){var r,i,o,s=m(e),a=m(t);if(s&&a){if((i=e.length)!=t.length)return!1;for(r=i;0!=r--;)if(!$(e[r],t[r],n))return!1;return!0}if(s!=a)return!1;var u=e instanceof Date,c=t instanceof Date;if(u!=c)return!1;if(u&&c)return e.getTime()==t.getTime();var l=e instanceof RegExp,h=t instanceof RegExp;if(l!=h)return!1;if(l&&h)return e.toString()==t.toString();var f=n?b(e):g(e),d=g(t);if((i=f.length)!==d.length)return!1;for(r=i;0!=r--;)if(!z.call(t,f[r]))return!1;for(r=i;0!=r--;)if(!$(e[o=f[r]],t[o],n))return!1;return!0}return e!=e&&t!=t}var x=function(e){function o(e,t,n){var r;(a(this,o),"object"!==p(n))&&(n={document:n});return(r=d(this,f(o).call(this,e,t,n,!1))).type="document",e.$data.$kuzzleData&&!e.$data.$kuzzleData.documents[t]&&e.$set(e.$data.$kuzzleData.documents,t,e.$data.$kuzzleData.queries[t]),r.firstRun=new Promise(function(e,t){r._firstRunResolve=e,r._firstRunReject=t}),r}var t,r,n,i;return h(o,k),c(o,[{key:"executeKuzzle",value:(i=s(regeneratorRuntime.mark(function e(){var t,n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.starting=!0,t=this.options,n=t.document,r=t.subscribe,this.setLoading(),e.prev=3,e.next=6,this.client.document.get(this.index,this.collection,n);case 6:if(i=e.sent)return e.next=10,this.nextResult(i._source,i,"get");e.next=10;break;case 10:this.loadingDone(null,i._source),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),this.catchError(e.t0);case 16:if(r)return e.next=19,this.startDocumentSubscription(n);e.next=19;break;case 19:v(f(o.prototype),"executeKuzzle",this).call(this);case 20:case"end":return e.stop()}},e,this,[[3,13]])})),function(){return i.apply(this,arguments)})},{key:"startDocumentSubscription",value:(n=s(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.clientSupportsRealtime||this.sub)return e.abrupt("return");e.next=2;break;case 2:return e.prev=2,e.next=5,this.client.realtime.subscribe(this.index,this.collection,{ids:{values:[t]}},function(e){return n.nextResult(e.result._source,e.result,"subscription")},{subscribeToSelf:!1});case 5:this.sub=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),this.catchError(e.t0);case 11:case"end":return e.stop()}},e,this,[[2,8]])})),function(e){return n.apply(this,arguments)})},{key:"nextResult",value:(r=s(regeneratorRuntime.mark(function e(t,n,r){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if("function"==typeof this.options.update)return e.next=5,Promise.resolve(this.options.update.call(this.vm,t,n,r));e.next=9;break;case 5:i=e.sent,this.setData(i),e.next=10;break;case 9:this.setData(t);case 10:case"end":return e.stop()}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"setLoading",value:function(){this.loading||this.applyLoadingModifier(1),this.loading=!0}},{key:"catchError",value:function(e){v(f(o.prototype),"catchError",this).call(this,e),this.loadingDone(e)}},{key:"watchLoading",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.callHandlers.apply(this,[[this.options.watchLoading,this.vm.$kuzzle.watchLoading,this.vm.$kuzzle.provider.watchLoading]].concat(t,[this]))}},{key:"applyLoadingModifier",value:function(e){var t=this.loadingKey;t&&"number"==typeof this.vm[t]&&(this.vm[t]+=e),this.watchLoading(1===e,e)}},{key:"loadingDone",value:function(e,t){this.loading&&this.applyLoadingModifier(-1),this.loading=!1,e?this.firstRunReject(e):(this.changeRun||(this.changeRun=this.firstRun),this.firstRunResolve(t))}},{key:"refetch",value:(t=s(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setLoading(),e.prev=1,e.next=4,this.client.document.get(this.index,this.collection,this.options.document);case 4:t=e.sent,this.loadingDone(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.catchError(e.t0);case 11:if(t)return e.next=14,this.nextResult(t._source,t,"get");e.next=14;break;case 14:case"end":return e.stop()}},e,this,[[1,8]])})),function(){return t.apply(this,arguments)})},{key:"change",value:function(c){var l=this;this.setLoading(),this.changeRun||(this.changeRun=Promise.resolve(null));var h=this.changeRun=this.changeRun.then(function(){var t=s(regeneratorRuntime.mark(function e(t){var n,r,i,o,s,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t&&Object.keys(t).every(function(e){return"_kuzzle_info"===e||c.hasOwnProperty(e)}),r=n?y(t,c):c,i={index:l.index,collection:l.collection,id:l.options.document,documentKey:l.key,savedDocument:t,changedDocument:c},"function"==typeof(o=l.options.changeFilter||l.vm.$kuzzle.changeFilter||l.vm.$kuzzle.provider.changeFilter))return e.prev=5,e.next=8,Promise.resolve(o.call(l.vm,r,i));e.next=15;break;case 8:r=e.sent,e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(5),l.catchError(e.t0),e.abrupt("return",t);case 15:if(r&&0!==Object.keys(r).length){e.next=18;break}return l.loadingDone(),e.abrupt("return",t);case 18:if(e.prev=18,l.options.document){e.next=25;break}return e.next=22,l.client.document.create(l.index,l.collection,r,null,{refresh:"wait_for"});case 22:s=e.sent,e.next=34;break;case 25:if(n){e.next=31;break}return e.next=28,l.client.document.createOrReplace(l.index,l.collection,l.options.document,r,{refresh:"wait_for"});case 28:s=e.sent,e.next=34;break;case 31:return e.next=33,l.client.document.update(l.index,l.collection,l.options.document,r,{refresh:"wait_for"});case 33:s=e.sent;case 34:return e.next=36,l.client.document.get(l.index,l.collection,s._id);case 36:if(a=e.sent._source,u=a,"function"==typeof l.options.update)return e.next=41,Promise.resolve(l.options.update.call(l.vm,a,s,s.created?"created":s.result));e.next=42;break;case 41:u=e.sent;case 42:return l.changeRun===h&&l.setData(u),l.loadingDone(),e.abrupt("return",a);case 47:return e.prev=47,e.t1=e.catch(18),l.catchError(e.t1),e.abrupt("return",t);case 51:case"end":return e.stop()}},e,null,[[5,11],[18,47]])}));return function(e){return t.apply(this,arguments)}}());return h.then(function(){return l.getData()})}},{key:"_initData",value:function(){var t=this;this.options.manual||(this._hasDataField?Object.defineProperty(this.vm.$data.$kuzzleData.data,this.key,{get:function(){return t.vm.$data[t.key]},set:function(e){return t.change(e)},enumerable:!0,configurable:!0}):Object.defineProperty(this.vm.$data,this.key,{get:function(){return t.vm.$data.$kuzzleData.data[t.key]},set:function(e){return t.change(e)},enumerable:!0,configurable:!0}))}},{key:"firstRunResolve",value:function(e){this._firstRunResolve&&(this._firstRunResolve(e),this._firstRunResolve=null)}},{key:"firstRunReject",value:function(e){this._firstRunReject&&(this._firstRunReject(e),this._firstRunReject=null)}},{key:"destroy",value:function(){v(f(o.prototype),"destroy",this).call(this),this.loading&&this.watchLoading(!1,-1),this.loading=!1}},{key:"loadingKey",get:function(){return this.options.loadingKey||this.vm.$kuzzle.loadingKey}}]),o}(),w=function(e){function i(e,t,n){var r;return a(this,i),(r=d(this,f(i).call(this,e,t,n,!1))).type="search",r}var t,n;return h(i,k),c(i,[{key:"executeKuzzle",value:(n=s(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.options.search,e.prev=1,e.next=4,this.client.document.search(this.index,this.collection,{query:t.query,aggregations:t.aggregations,sort:t.sort},{from:t.from||0,size:t.size||10});case 4:this.response=e.sent,n=this.response.hits.map(function(e){return e._source}),this.nextResult(n,this.response),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),this.catchError(e.t0);case 12:v(f(i.prototype),"executeKuzzle",this).call(this);case 13:case"end":return e.stop()}},e,this,[[1,9]])})),function(){return n.apply(this,arguments)})},{key:"fetchMore",value:(t=s(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.response){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.response.next();case 5:t=e.sent,(n=t.hits.map(function(e){return e._source}))&&(r=[].concat(o(this.getData()),o(n)),this.nextResult(r,t)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),this.catchError(e.t0);case 13:case"end":return e.stop()}},e,this,[[2,10]])})),function(){return t.apply(this,arguments)})},{key:"nextResult",value:function(e,t){"function"==typeof this.options.update?this.setData(this.options.update.call(this.vm,e,t)):this.setData(e)}},{key:"hasMore",get:function(){return!!this.response&&this.response.fetched<this.response.total}}]),i}(),i=function(){function t(e){a(this,t),this._kuzzleSubscriptions=[],this._watchers=[],this.vm=e,this.queries={},this.documents={},this.searches={},this.client=void 0,this.loadingKey=void 0,this.error=void 0}var r,n,i,o;return c(t,[{key:"getClient",value:function(e){if(!e||!e.client){if("object"===p(this.client))return this.client;if(this.client){if(this.provider.clients){var t=this.provider.clients[this.client];if(!t)throw new Error("[vue-kuzzle] Missing client '".concat(this.client,"' in 'kuzzleProvider'"));return t}throw new Error("[vue-kuzzle] Missing 'clients' options in 'kuzzleProvider'")}return this.provider.defaultClient}var n=this.provider.clients[e.client];if(!n)throw new Error("[vue-kuzzle] Missing client '".concat(e.client,"' in 'kuzzleProvider'"));return n}},{key:"query",value:function(e,t){var n=this.getIndexAndCollection(t),r=n.index,i=n.collection;try{return this.getClient(t).query({index:r,collection:i,controller:t.controller,action:t.action,_id:t.id,body:e,refresh:"wait_for"})}catch(e){throw new Error("[vue-kuzzle] ".concat(e))}}},{key:"get",value:(o=s(regeneratorRuntime.mark(function e(t,n){var r,i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getIndexAndCollection(n,"getDocument"),i=r.index,o=r.collection,e.next=3,this.getClient(n).document.get(i,o,t);case 3:return s=e.sent,e.abrupt("return",l({},s._source,{_kuzzle_response:s}));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"search",value:(i=s(regeneratorRuntime.mark(function e(t,n){var r,i,o,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getIndexAndCollection(n,"searchDocuments"),i=r.index,o=r.collection,e.next=3,this.getClient(n).document.search(i,o,{query:t,aggregations:n&&n.aggregations,sort:n&&n.sort},{from:n&&n.from||0,size:n&&n.size||10});case 3:return s=e.sent,(a=(s.hits||[]).slice())._kuzzle_response=s,e.abrupt("return",a);case 7:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"create",value:(n=s(regeneratorRuntime.mark(function e(t,n){var r,i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getIndexAndCollection(n,"createDocument"),i=r.index,o=r.collection,!n||!0!==n.replace){e.next=7;break}if(n.id){e.next=4;break}throw new Error("[vue-kuzzle] Missing 'id' in 'createDocument' called with 'replace: true'");case 4:return e.next=6,this.getClient(n).document.createOrReplace(i,o,n&&n.id,t,{refresh:"wait_for"});case 6:s=e.sent;case 7:return e.next=9,this.getClient(n).document.create(i,o,t,n&&n.id,{refresh:"wait_for"});case 9:return s=e.sent,e.abrupt("return",l({},s._source,{_kuzzle_response:s}));case 11:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"change",value:(r=s(regeneratorRuntime.mark(function e(t,n,r){var i,o,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.getIndexAndCollection(r,"changeDocument"),o=i.index,s=i.collection,r&&!0===r.replace)return e.next=4,this.getClient(r).document.replace(o,s,t,n,{refresh:"wait_for"});e.next=5;break;case 4:a=e.sent;case 5:return e.next=7,this.getClient(r).document.update(o,s,t,n,{refresh:"wait_for"});case 7:return a=e.sent,e.abrupt("return",l({},a._source,{_kuzzle_response:a}));case 9:case"end":return e.stop()}},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"delete",value:function(e,t){var n=this.getIndexAndCollection(t,"deleteDocument"),r=n.index,i=n.collection;return this.getClient(t).document.delete(r,i,e,{refresh:"wait_for"})}},{key:"addSmartDocumentOrSearch",value:function(e,t){var n,r=function(e,t){for(;"function"==typeof e;)e=e.call(t);return e}(t,this.vm);if(void 0!==r.document)n=this.queries[e]=this.documents[e]=new x(this.vm,e,r,!1);else{if("undefined"===r.search)throw new Error("[vue-kuzzle] Missing either 'document' or 'search' in 'kuzzle.".concat(e,"' options"));n=this.queries[e]=this.searches[e]=new w(this.vm,e,r,!1)}return this.vm.$isServer||n.autostart(),n}},{key:"defineReactiveSetter",value:function(t,e,n){var r=this;this._watchers.push(this.vm.$watch(e,function(e){r[t]=e},{immediate:!0,deep:n}))}},{key:"getIndexAndCollection",value:function(e,t){var n=e&&e.index||this.index||this.provider.defaultIndex,r=e&&e.collection||this.collection||this.provider.defaultCollection;if(t){if(!n)throw new Error("[vue-kuzzle] Missing index in '".concat(t,"'"));if(!r)throw new Error("[vue-kuzzle] Missing collection in '".concat(t,"'"))}return{index:n,collection:r}}},{key:"destroy",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this._watchers[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){(0,r.value)()}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}for(var o in this.queries)this.queries[o].destroy();this.vm=null}},{key:"provider",get:function(){return this.vm.$kuzzleProvider}},{key:"loading",get:function(){return 0!==this.vm.$data.$kuzzleData.loading}},{key:"data",get:function(){return this.vm.$data.$kuzzleData.data}}]),t}(),t=function(){function t(e){if(a(this,t),!e)throw new Error("Options argument required");this.clients=e.clients||{},this.clients.defaultClient=this.defaultClient=e.defaultClient,this.defaultOptions=e.defaultOptions||{},this.defaultIndex=e.defaultIndex,this.defaultCollection=e.defaultCollection,this.watchLoading=e.watchLoading,this.errorHandler=e.errorHandler,this.changeFilter=e.changeFilter,this.connectAll()}return c(t,[{key:"connectAll",value:function(){return this._connectAllPromise||(this._connectAllPromise=Promise.all(Object.values(this.clients).map(function(e){return e.connect()}))),this._connectAllPromise}}]),t}();function _(e,t){return void 0!==e&&Object.prototype.hasOwnProperty.call(e,t)}function R(){var e=this.$options,t=e.kuzzleProvider;t?this.$kuzzleProvider="function"==typeof t?t():t:e.parent&&e.parent.$kuzzleProvider&&(this.$kuzzleProvider=e.parent.$kuzzleProvider)}function D(){var e=this,t=this.$kuzzleProvider;if(!this._kuzzleLaunched&&t){this._kuzzleLaunched=!0;var n=this.$options.kuzzle;if(n)for(var r in this.$_kuzzlePromises=[],n.$init||(n.$init=!0,t.defaultOptions&&(n=this.$options.kuzzle=Object.assign({},t.defaultOptions,n))),O(this.$kuzzle,"client",n.$client,n.$deep),O(self.$kuzzle,"index",n.$index,n.$deep),O(self.$kuzzle,"collection",n.$collection,n.$deep),O(this.$kuzzle,"loadingKey",n.$loadingKey,n.$deep),O(this.$kuzzle,"error",n.$error,n.$deep),O(this.$kuzzle,"watchLoading",n.$watchLoading,n.$deep),Object.defineProperty(this,"$kuzzleData",{get:function(){return e.$data.$kuzzleData},enumerable:!0,configurable:!0}),n)if("$"!==r.charAt(0)){var i=n[r],o=this.$kuzzle.addSmartDocumentOrSearch(r,i);!1!==i.prefetch&&!1!==n.$prefetch&&this.$_kuzzlePromises.push(o.firstRun)}}}function O(e,t,n,r){void 0!==n&&("function"==typeof n?e.defineReactiveSetter(t,n,r):e[t]=n)}function P(){this.$_kuzzle&&(this.$_kuzzle.destroy(),this.$_kuzzle=null)}function j(e,t){e.mixin(l({},"1"===t?{init:R}:{},"2"===t?{data:function(){return{$kuzzleData:{queries:{},documents:{},searches:{},loading:0,data:this.$_kuzzleInitData}}},beforeCreate:function(){R.call(this),function(){var n=this;this.$_kuzzleInitData={};var e=this.$options.kuzzle;if(e){var t=function(t){"$"!==t.charAt(0)&&(e[t].manual||_(n.$options.props,t)||_(n.$options.computed,t)||_(n.$options.methods,t)||Object.defineProperty(n,t,{get:function(){return n.$data.$kuzzleData.data[t]},set:function(e){return n.$_kuzzleInitData[t]=e},enumerable:!0,configurable:!0}))};for(var r in e)t(r)}}.call(this)},serverPrefetch:function(){if(this.$_kuzzlePromises)return Promise.all(this.$_kuzzlePromises)}}:{},{created:D,destroyed:P}))}function C(e,t){if(!C.installed){C.installed=!0;var n=e.version.substr(0,e.version.indexOf("."));Object.defineProperty(e.prototype,"$kuzzle",{get:function(){return this.$_kuzzle||(this.$_kuzzle=new i(this)),this.$_kuzzle}}),j(e,n)}}t.install=C;var E=t,S=null;return"undefined"!=typeof window?S=window.Vue:"undefined"!=typeof global&&(S=global.Vue),S&&S.use(t),e.install=C,e.KuzzleProvider=E,e.default=t,e}({});
